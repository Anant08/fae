<% require_locals ['item', 'f'], local_assigns %>

<%
  # passed in variables
  image_name   ||= :image
  the_image      = item.send(image_name)
  image_label  ||= image_name.to_s.humanize
  alt_label    ||= "#{image_label} alt text"
  helper_text  ||= ""
  alt_helper_text   ||= ""
  caption_helper_text ||= ""
  omit         ||= [:caption]
  show_thumb   ||= false
  required     ||= false

%>

<%= f.simple_fields_for image_name do |i| %>
  <div class="field input">
    <%= content_tag :label, class: ('required' if required) do  %>
      <%= content_tag :abbr, '*', title: 'required' if required %>
      <%= image_label.html_safe %>
      <%= content_tag :h6, "#{helper_text}", class: 'helper_text' if helper_text.present? %>
    <% end %>

    <% if the_image.asset.present? %>
      <div class="asset-actions">
        <%= image_tag the_image.asset.url %>
        <%= link_to 'Original', the_image.asset.url, class: "js-image-modal asset-actions-image-link" %>
        <%= link_to 'Thumb', the_image.asset.thumb.url, class: "js-image-modal asset-actions-image-link" if show_thumb %>
        <%= link_to '', fae.delete_image_path(the_image.id), class: 'js-asset-delete-link icon-delete_x', remote: true, method: :delete, 'data-confirm' => 'Are you sure?' if the_image.id.present? %>
      </div>
    <% end %>

    <div class="asset-inputs" style="<%= "display:none;" if the_image.asset.present? %>">
      <%= i.input :asset, as: :file, label: false %>
      <%= i.input :asset_cache, as: :hidden %>
      <%= i.input :attached_as, as: :hidden, input_html: {value: image_name.to_s} %>
    </div>
  </div>

  <% unless omit.include?(:caption)
    options = {label: "#{image_label} caption"}
    options[:helper_text] = "#{caption_helper_text}" if caption_helper_text.present?
  %>
    <%= fae_input i, :caption, options %>
  <% end %>

  <% unless omit.include?(:alt)
    options = { label: alt_label.html_safe }
    options[:helper_text] = "#{caption_helper_text}" if caption_helper_text.present?
  %>
    <%= fae_input i, :alt, options %>
  <% end %>
<% end %>